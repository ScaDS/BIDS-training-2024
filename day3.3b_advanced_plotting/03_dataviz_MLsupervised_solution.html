

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Part 3: Machine Learning insights by Data Viz &#8212; Bio-image Data Science Training School @ ScaDS.AI, May 2024</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'day3.3b_advanced_plotting/03_dataviz_MLsupervised_solution';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Code of Conduct" href="../CONDUCT.html" />
    <link rel="prev" title="Part 2 Data exploration by unsupervised learning" href="02_dataviz_MLunsupervised_solution.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Bio-Image Data Science Training Schools 2024
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Preparation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../day0_preparation/readme.html">Setting up your computer</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Monday</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../day1.1_python_basics/readme.html">Python basics</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/01_jupyter_notebooks.html">Python code and Jupyter notebooks</a></li>

<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/02_basic_terms_and_types.html">Basics terms and types for Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/03_notebook_pitfalls.html">Pitfalls when working with Jupyter notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/04_math_in_python.html">Basic math in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/05_sequence_types.html">Sequences in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/05a_indexing_sequences.html">Indexing and slicing of sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/05b_masking_arrays.html">Masking NumPy arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/06_dictionaries_and_tables.html">Dictionaries</a></li>

<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/07_conditions.html">Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/08_loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.1_python_basics/09_custom_functions.html">Custom Functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../day1.2_file_handling/readme.html">File handling and working with images</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../day1.2_file_handling/01_list_files_in_a_folder.html">How process files in a folder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.2_file_handling/02_interactive_image_visualization.html">Image visualization with stackview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.2_file_handling/03_opening_images_using_aicsimageio.html">Reading files with AICSImageIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.2_file_handling/04_nextcloud.html">Optional: Accessing image files in the nextcloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.2_file_handling/05_bia_bob.html">Optional: Coding assistance</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../day1.3_image_processing_basics/readme.html">Image processing basics</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../day1.3_image_processing_basics/00_images_as_arrays.html">Images are arrays of numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.3_image_processing_basics/01_opening_visualizing_images.html">Opening and visualizing images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.3_image_processing_basics/02_Brightness_and_Contrast.html">Brightness and Contrast</a></li>

<li class="toctree-l2"><a class="reference internal" href="../day1.3_image_processing_basics/03_Cropping_images.html">Cropping images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.3_image_processing_basics/04_Image_Filters.html">Image Processing Filters</a></li>


<li class="toctree-l2"><a class="reference internal" href="../day1.3_image_processing_basics/05_Binarization.html">Image Binarization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day1.3_image_processing_basics/06_Morphological_operations.html">Morphological Image Processing</a></li>


<li class="toctree-l2"><a class="reference internal" href="../day1.3_image_processing_basics/bonus_simulated_dataset_remove_noise_and_background.html">Simulation of image formation + image restoration</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tuesday</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../day2.1_image_segmentation/readme.html">Image segmentation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../day2.1_image_segmentation/10_napari-assistant.html">Interactive bioimage analysis workflow design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.1_image_segmentation/11_notebook_export.html">Generating Jupyter Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.1_image_segmentation/12_voronoi_otsu_labeling.html">Voronoi-Otsu-labeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.1_image_segmentation/13_watershed.html">The [seeded] watershed algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.1_image_segmentation/22_napari_intro.html">Scripting Napari using Python</a></li>

<li class="toctree-l2"><a class="reference internal" href="../day2.1_image_segmentation/30_Segmentation_3D.html">3D Image Segmentation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../day2.2_feature_extraction/readme.html">Feature extraction</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../day2.2_feature_extraction/01_count_blobs.html">Counting bright objects in images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.2_feature_extraction/02_statistics_with_scikit_image.html">Statistics using Scikit-image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.2_feature_extraction/03_statistics_with_simpleitk.html">Statistics using SimpleITK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.2_feature_extraction/04_roundness_circularity.html">Shape features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../day2.3_machine_learning/readme.html">Machine Learning</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../day2.4_tabular_data_wrangling/readme.html">Tabular data wrangling</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../day2.4_tabular_data_wrangling/01_introduction_dataframes.html">Introduction to working with DataFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.4_tabular_data_wrangling/02_selecting_dataframes.html">Selecting data from DataFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.4_tabular_data_wrangling/03_appending_dataframes.html">Appending and extending DataFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.4_tabular_data_wrangling/04_handle_missing_data.html">Handling missing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.4_tabular_data_wrangling/05_group_by.html">Group by: split-apply-combine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day2.4_tabular_data_wrangling/06_tidy_data.html">Tidy-Data</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wednesday</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../day3.1_explorative_data_science/readme.html">Explorative data science</a></li>
<li class="toctree-l1"><a class="reference internal" href="../day3.2_data_visualization/readme.html">Data Visualization</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../day3.3a_basic_plotting/readme.html">Plotting Basics</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../day3.3a_basic_plotting/01_Introduction_to_Seaborn.html">Introduction to Seaborn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../day3.3a_basic_plotting/02_Plotting_distributions.html">Plotting Distributions with Seaborn</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="readme.html">Advanced Plotting</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="00_getdata.html">Part 0: Get data set for plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_seabornobj_solution.html">Part 1: Time series and other simple plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_dataviz_MLunsupervised_solution.html">Part 2 Data exploration by unsupervised learning</a></li>

<li class="toctree-l2 current active"><a class="current reference internal" href="#">Part 3: Machine Learning insights by Data Viz</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Information</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../CONDUCT.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imprint.html">Imprint</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/scads/BIDS-training-2024" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/scads/BIDS-training-2024/issues/new?title=Issue%20on%20page%20%2Fday3.3b_advanced_plotting/03_dataviz_MLsupervised_solution.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/day3.3b_advanced_plotting/03_dataviz_MLsupervised_solution.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Part 3: Machine Learning insights by Data Viz</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-feature-correlation-first-try">Plotting feature correlation: first try</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-with-standard-correlation-heatmap-colormap-not-suitable-and-features-not-ordered-by-similarity">Problem with standard correlation heatmap: colormap not suitable and features not ordered by similarity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-can-be-seen-in-the-correlation-heatmap">What can be seen in the correlation heatmap?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ml-show-case-predict-the-manuel-text-annotation-of-the-weather-by-the-numerical-features">ML show case: predict the manuel text annotation of the weather by the numerical features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#for-simplicity-reducing-to-top-categories">For simplicity reducing to Top categories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#insights-into-more-complex-ml-models-random-forest">Insights into more complex ML models: Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-results-confusion-matrix">Plotting results: confusion matrix</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-explainability-from-feature-importance">Getting explainability from feature importance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-importance-from-learned-models-across-all-cross-validations-for-robustness">Extracting importance from learned models across all cross validations for robustness</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#show-importance-as-bar-chart-including-errorbars">Show importance as bar chart including errorbars</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trick-flip-x-and-y-axis-for-readibility">Trick: flip x and y axis for readibility</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#there-are-problems-with-bar-charts-and-errorbars-https-doi-org-10-1371-journal-pbio-1002128">There are problems with bar charts and errorbars: https://doi.org/10.1371/journal.pbio.1002128</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#better-show-points-dots-for-every-trained-model-sample-and-statistics">Better show points/dots for every trained model (sample) and statistics</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="part-3-machine-learning-insights-by-data-viz">
<h1>Part 3: Machine Learning insights by Data Viz<a class="headerlink" href="#part-3-machine-learning-insights-by-data-viz" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span> <span class="c1">## suppress annoying deprecation warnings</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn.objects</span> <span class="k">as</span> <span class="nn">so</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Renaming columns for better axis labels in plots</span>

<span class="n">col_rename</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s1">&#39;tavg&#39;</span><span class="p">:</span> <span class="s1">&#39;Temp_Avg_°C&#39;</span><span class="p">,</span>
	<span class="s1">&#39;tmax&#39;</span><span class="p">:</span> <span class="s1">&#39;Temp_Max_°C&#39;</span><span class="p">,</span>
	<span class="s1">&#39;tmin&#39;</span><span class="p">:</span> <span class="s1">&#39;Temp_Min_°C&#39;</span><span class="p">,</span>
	<span class="s1">&#39;rhum&#39;</span><span class="p">:</span> <span class="s1">&#39;Rel_Humidity_%&#39;</span><span class="p">,</span>
	<span class="s1">&#39;coco&#39;</span><span class="p">:</span> <span class="s1">&#39;Condition&#39;</span><span class="p">,</span>
	<span class="s1">&#39;wspd&#39;</span><span class="p">:</span> <span class="s1">&#39;Wind_Speed_kmh&#39;</span><span class="p">,</span>
	<span class="s1">&#39;prcp&#39;</span><span class="p">:</span> <span class="s1">&#39;Precipation_mm&#39;</span><span class="p">,</span>
	<span class="s1">&#39;wdir&#39;</span><span class="p">:</span> <span class="s1">&#39;Wind_Direction_°&#39;</span><span class="p">,</span>
	<span class="s1">&#39;pres&#39;</span><span class="p">:</span> <span class="s1">&#39;Air_pressure_hPa&#39;</span><span class="p">,</span>
	<span class="s1">&#39;dwpt&#39;</span><span class="p">:</span> <span class="s1">&#39;Dew_point_°C&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Reload data</span>
<span class="n">weather_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;global_weather.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wmo&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;station&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">})</span> 
<span class="n">weather_df</span> <span class="o">=</span> <span class="n">weather_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">weather_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col_rename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">weather_df</span> <span class="o">=</span> <span class="n">weather_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Continent</span> <span class="o">=</span> <span class="n">weather_df</span><span class="p">[</span><span class="s2">&quot;timezone&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1">## Get continent from timezone column</span>
</pre></div>
</div>
</div>
</div>
<section id="plotting-feature-correlation-first-try">
<h2>Plotting feature correlation: first try<a class="headerlink" href="#plotting-feature-correlation-first-try" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weather_corr</span> <span class="o">=</span> <span class="n">weather_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span> <span class="c1">## Calculate (Pearson) correlation for all numerical features in dataframe</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="c1">#!# sns.??(weather_corr, ## seaborn.object no function for heatmaps yet</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">weather_corr</span><span class="p">,</span> <span class="c1">## seaborn.object no function for heatmaps yet</span>
			<span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Pearson correlation coefficient&quot;</span><span class="p">,</span> <span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">}</span> <span class="c1">## Label adjustments</span>
			<span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/20beee7da0e4d51689c8bc653f93736eec53b7e99734f5d8c756d829fc8007b0.png" src="../_images/20beee7da0e4d51689c8bc653f93736eec53b7e99734f5d8c756d829fc8007b0.png" />
</div>
</div>
</section>
<section id="problem-with-standard-correlation-heatmap-colormap-not-suitable-and-features-not-ordered-by-similarity">
<h2>Problem with standard correlation heatmap: colormap not suitable and features not ordered by similarity<a class="headerlink" href="#problem-with-standard-correlation-heatmap-colormap-not-suitable-and-features-not-ordered-by-similarity" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span><span class="n">weather_corr</span><span class="p">,</span>                                            <span class="c1">## Clustermap will cluster the features by similarity</span>
			    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;vlag&#39;</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>                  <span class="c1">## Colormap: correlations range from -1 to +1 and have fixed midpoint at 0                                  </span>
				<span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Pearson correlation coefficient&quot;</span><span class="p">},</span>  <span class="c1">## Color legend description</span>
                <span class="n">cbar_pos</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>						<span class="c1">## Change the weird default position of legend</span>
				<span class="p">)</span><span class="o">.</span><span class="n">ax_row_dendrogram</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>					<span class="c1">## Dendrogram of feature similarity is identical (symmetric matrix); we can omit it on one side</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dbba3c26a8e8d20beaf3879a45a5764617b1eec1db336754b5a1d745546946cf.png" src="../_images/dbba3c26a8e8d20beaf3879a45a5764617b1eec1db336754b5a1d745546946cf.png" />
</div>
</div>
</section>
<section id="what-can-be-seen-in-the-correlation-heatmap">
<h2>What can be seen in the correlation heatmap?<a class="headerlink" href="#what-can-be-seen-in-the-correlation-heatmap" title="Permalink to this heading">#</a></h2>
<p>(1) features with (almost) identical information (redundancy) <br>
(2) association of learned embeddings (t-SNE, PCA) with features</p>
</section>
<section id="ml-show-case-predict-the-manuel-text-annotation-of-the-weather-by-the-numerical-features">
<h2>ML show case: predict the manuel text annotation of the weather by the numerical features<a class="headerlink" href="#ml-show-case-predict-the-manuel-text-annotation-of-the-weather-by-the-numerical-features" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weather_df</span><span class="p">[</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Condition
Cloudy               827
Fair                 734
Clear                557
Overcast             239
Light Rain           108
Fog                  105
Rain                  69
Heavy Rain Shower     60
Heavy Rain            50
Rain Shower           29
Thunderstorm          19
Light Snowfall        11
Snow Shower            4
Sleet                  3
Snowfall               3
Heavy Snowfall         3
Heavy Snow Shower      3
Heavy Sleet            1
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="for-simplicity-reducing-to-top-categories">
<h2>For simplicity reducing to Top categories<a class="headerlink" href="#for-simplicity-reducing-to-top-categories" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weather_df_red</span> <span class="o">=</span> <span class="n">weather_df</span><span class="p">[</span>
	<span class="n">weather_df</span><span class="p">[</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span> 
		<span class="n">weather_df</span><span class="p">[</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>  <span class="c1">## Top categories</span>
		<span class="p">)</span> 
	<span class="p">]</span>

<span class="n">weather_df_red</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>country</th>
      <th>region</th>
      <th>wmo</th>
      <th>icao</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>elevation</th>
      <th>timezone</th>
      <th>hourly_start</th>
      <th>...</th>
      <th>Rel_Humidity_%</th>
      <th>Condition</th>
      <th>Temp_Avg_°C</th>
      <th>Temp_Min_°C</th>
      <th>Temp_Max_°C</th>
      <th>Precipation_mm</th>
      <th>Wind_Direction_°</th>
      <th>Wind_Speed_kmh</th>
      <th>Air_pressure_hPa</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Peshawar</td>
      <td>PK</td>
      <td>N</td>
      <td>41530</td>
      <td>OPPS</td>
      <td>34.0167</td>
      <td>71.5833</td>
      <td>359.0</td>
      <td>Asia/Karachi</td>
      <td>1944-01-01</td>
      <td>...</td>
      <td>100.0</td>
      <td>Clear</td>
      <td>10.8</td>
      <td>9.0</td>
      <td>12.5</td>
      <td>65.0</td>
      <td>12.0</td>
      <td>11.7</td>
      <td>1005.5</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Peshawar</td>
      <td>PK</td>
      <td>N</td>
      <td>41530</td>
      <td>OPPS</td>
      <td>34.0167</td>
      <td>71.5833</td>
      <td>359.0</td>
      <td>Asia/Karachi</td>
      <td>1944-01-01</td>
      <td>...</td>
      <td>94.0</td>
      <td>Cloudy</td>
      <td>8.9</td>
      <td>5.5</td>
      <td>13.0</td>
      <td>16.0</td>
      <td>330.0</td>
      <td>20.4</td>
      <td>1012.6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Peshawar</td>
      <td>PK</td>
      <td>N</td>
      <td>41530</td>
      <td>OPPS</td>
      <td>34.0167</td>
      <td>71.5833</td>
      <td>359.0</td>
      <td>Asia/Karachi</td>
      <td>1944-01-01</td>
      <td>...</td>
      <td>54.0</td>
      <td>Fair</td>
      <td>11.3</td>
      <td>4.5</td>
      <td>18.0</td>
      <td>0.0</td>
      <td>270.0</td>
      <td>14.2</td>
      <td>1020.1</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Peshawar</td>
      <td>PK</td>
      <td>N</td>
      <td>41530</td>
      <td>OPPS</td>
      <td>34.0167</td>
      <td>71.5833</td>
      <td>359.0</td>
      <td>Asia/Karachi</td>
      <td>1944-01-01</td>
      <td>...</td>
      <td>50.0</td>
      <td>Fog</td>
      <td>13.7</td>
      <td>5.5</td>
      <td>21.5</td>
      <td>0.0</td>
      <td>222.0</td>
      <td>13.7</td>
      <td>1019.3</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Peshawar</td>
      <td>PK</td>
      <td>N</td>
      <td>41530</td>
      <td>OPPS</td>
      <td>34.0167</td>
      <td>71.5833</td>
      <td>359.0</td>
      <td>Asia/Karachi</td>
      <td>1944-01-01</td>
      <td>...</td>
      <td>51.0</td>
      <td>Fog</td>
      <td>14.9</td>
      <td>6.0</td>
      <td>21.5</td>
      <td>0.0</td>
      <td>222.0</td>
      <td>8.1</td>
      <td>1015.7</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3687</th>
      <td>Fuerteventura / Aeropuerto</td>
      <td>ES</td>
      <td>CN</td>
      <td>60035</td>
      <td>GCFV</td>
      <td>28.4500</td>
      <td>-13.8667</td>
      <td>22.0</td>
      <td>Europe/Madrid</td>
      <td>1950-03-27</td>
      <td>...</td>
      <td>78.0</td>
      <td>Clear</td>
      <td>19.9</td>
      <td>16.7</td>
      <td>22.0</td>
      <td>0.0</td>
      <td>32.0</td>
      <td>12.2</td>
      <td>1018.1</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3688</th>
      <td>Fuerteventura / Aeropuerto</td>
      <td>ES</td>
      <td>CN</td>
      <td>60035</td>
      <td>GCFV</td>
      <td>28.4500</td>
      <td>-13.8667</td>
      <td>22.0</td>
      <td>Europe/Madrid</td>
      <td>1950-03-27</td>
      <td>...</td>
      <td>57.0</td>
      <td>Fair</td>
      <td>23.0</td>
      <td>18.8</td>
      <td>28.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>12.5</td>
      <td>1016.2</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3689</th>
      <td>Fuerteventura / Aeropuerto</td>
      <td>ES</td>
      <td>CN</td>
      <td>60035</td>
      <td>GCFV</td>
      <td>28.4500</td>
      <td>-13.8667</td>
      <td>22.0</td>
      <td>Europe/Madrid</td>
      <td>1950-03-27</td>
      <td>...</td>
      <td>73.0</td>
      <td>Clear</td>
      <td>21.9</td>
      <td>20.0</td>
      <td>26.0</td>
      <td>0.0</td>
      <td>331.0</td>
      <td>27.7</td>
      <td>1016.2</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3690</th>
      <td>Fuerteventura / Aeropuerto</td>
      <td>ES</td>
      <td>CN</td>
      <td>60035</td>
      <td>GCFV</td>
      <td>28.4500</td>
      <td>-13.8667</td>
      <td>22.0</td>
      <td>Europe/Madrid</td>
      <td>1950-03-27</td>
      <td>...</td>
      <td>69.0</td>
      <td>Fair</td>
      <td>20.2</td>
      <td>18.0</td>
      <td>23.0</td>
      <td>0.0</td>
      <td>19.0</td>
      <td>24.9</td>
      <td>1017.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3691</th>
      <td>Fuerteventura / Aeropuerto</td>
      <td>ES</td>
      <td>CN</td>
      <td>60035</td>
      <td>GCFV</td>
      <td>28.4500</td>
      <td>-13.8667</td>
      <td>22.0</td>
      <td>Europe/Madrid</td>
      <td>1950-03-27</td>
      <td>...</td>
      <td>47.0</td>
      <td>Fair</td>
      <td>20.2</td>
      <td>17.4</td>
      <td>24.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>29.7</td>
      <td>1018.5</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
<p>2570 rows × 28 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">weather_df_red</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">)</span> 	<span class="c1">## Define features</span>
<span class="c1">#!# y = weather_df_red[??]  				## Define target variable</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">weather_df_red</span><span class="p">[</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span>  				<span class="c1">## Define target variable</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">,</span> <span class="n">max_leaf_nodes</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span> <span class="c1">## Define a simple decision tree</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>		<span class="c1">## training</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>  <span class="c1">## Plot the full decision tree</span>
<span class="n">anno</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">plot_tree</span><span class="p">(</span>	<span class="n">clf</span><span class="p">,</span> 									<span class="c1">## Decision tree</span>
			   	<span class="n">feature_names</span><span class="o">=</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_names_in_</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>	<span class="c1">## Features names</span>
			   	<span class="n">class_names</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">classes_</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>			<span class="c1">## Weather condition text</span>
				<span class="n">filled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>									<span class="c1">## Colored by class decision</span>
				<span class="n">impurity</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span>								<span class="c1">## For simiplicity exclude impurity values at splits</span>
				<span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>									<span class="c1">## decimal precision</span>
				<span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>									<span class="c1">## Fontsize for readibility</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1e2a6c5d310da08f67fa33d60b21f86949d493679061a54fc773ca1c3b5eb7e1.png" src="../_images/1e2a6c5d310da08f67fa33d60b21f86949d493679061a54fc773ca1c3b5eb7e1.png" />
</div>
</div>
</section>
<section id="insights-into-more-complex-ml-models-random-forest">
<h2>Insights into more complex ML models: Random Forest<a class="headerlink" href="#insights-into-more-complex-ml-models-random-forest" title="Permalink to this heading">#</a></h2>
<section id="plotting-results-confusion-matrix">
<h3>Plotting results: confusion matrix<a class="headerlink" href="#plotting-results-confusion-matrix" title="Permalink to this heading">#</a></h3>
<p>Important for Confusion Matrix visualization is color + number per entry for pattern exploration and precision</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">,</span> <span class="n">max_leaf_nodes</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1">## What happens if we negelect class imbalance?</span>
<span class="c1">#!# clf_rf = RandomForestClassifier(n_estimators=100,  class_weight=None, max_leaf_nodes=20) ## What happens if we negelect class imbalance?</span>


<span class="n">output</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">clf_rf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">return_estimator</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">## RandomForest is non-deterministic ML -&gt; Cross-validation for more robust results</span>

<span class="n">clf_rf_1</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1">## Select a learned RF from the cross-validation</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf_rf_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">clf_rf_1</span><span class="o">.</span><span class="n">classes_</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">display_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.metrics._plot.confusion_matrix.ConfusionMatrixDisplay at 0x7fa249222430&gt;
</pre></div>
</div>
<img alt="../_images/287a53a27c2866f045ce322c446be3011ec69831753b0e7ddbbec13a0b65a053.png" src="../_images/287a53a27c2866f045ce322c446be3011ec69831753b0e7ddbbec13a0b65a053.png" />
</div>
</div>
</section>
</section>
<section id="getting-explainability-from-feature-importance">
<h2>Getting explainability from feature importance<a class="headerlink" href="#getting-explainability-from-feature-importance" title="Permalink to this heading">#</a></h2>
<section id="extracting-importance-from-learned-models-across-all-cross-validations-for-robustness">
<h3>Extracting importance from learned models across all cross validations for robustness<a class="headerlink" href="#extracting-importance-from-learned-models-across-all-cross-validations-for-robustness" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">])</span> <span class="c1">## Empty Data frame definition</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">estimator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">]):</span>  <span class="c1">## For each tree in RF</span>
    <span class="n">feature_importances</span> <span class="o">=</span> <span class="n">feature_importances</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>         
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">estimator</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="p">,</span>             <span class="c1">## Calculated feature importance</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">feature_names_in_</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="c1">## Feature Names</span>
                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;importance_cv&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>         <span class="c1">## Save from which CV split</span>
            <span class="p">)</span>

<span class="c1"># feature_importances</span>
<span class="c1">#!# feature_importances_long = pd.??( feature_importances, stubnames=&quot;importance_cv&quot;,i=&quot;feature&quot;,j=&quot;cv&quot;) </span>
<span class="n">feature_importances_long</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">wide_to_long</span><span class="p">(</span> <span class="n">feature_importances</span><span class="p">,</span> <span class="n">stubnames</span><span class="o">=</span><span class="s2">&quot;importance_cv&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="s2">&quot;cv&quot;</span><span class="p">)</span> 

<span class="n">feature_importances_long</span><span class="o">.</span><span class="n">head</span><span class="p">()</span> <span class="c1">## We need typically long format for plotting in grammar of graphics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>importance_cv</th>
    </tr>
    <tr>
      <th>feature</th>
      <th>cv</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>latitude</th>
      <th>1</th>
      <td>0.124856</td>
    </tr>
    <tr>
      <th>longitude</th>
      <th>1</th>
      <td>0.203709</td>
    </tr>
    <tr>
      <th>elevation</th>
      <th>1</th>
      <td>0.066899</td>
    </tr>
    <tr>
      <th>Dew_point_°C</th>
      <th>1</th>
      <td>0.051925</td>
    </tr>
    <tr>
      <th>Rel_Humidity_%</th>
      <th>1</th>
      <td>0.136801</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="show-importance-as-bar-chart-including-errorbars">
<h2>Show importance as bar chart including errorbars<a class="headerlink" href="#show-importance-as-bar-chart-including-errorbars" title="Permalink to this heading">#</a></h2>
<section id="trick-flip-x-and-y-axis-for-readibility">
<h3>Trick: flip x and y axis for readibility<a class="headerlink" href="#trick-flip-x-and-y-axis-for-readibility" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
<span class="c1">#!#    so.Plot(feature_importances_long,x=??,y=??)</span>
    <span class="n">so</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">feature_importances_long</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;importance_cv&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">so</span><span class="o">.</span><span class="n">Bar</span><span class="p">(),</span> <span class="n">so</span><span class="o">.</span><span class="n">Agg</span><span class="p">())</span>				<span class="c1">## Bar plot showing the average</span>
	<span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">so</span><span class="o">.</span><span class="n">Range</span><span class="p">(),</span> <span class="n">so</span><span class="o">.</span><span class="n">Est</span><span class="p">(</span><span class="n">errorbar</span><span class="o">=</span><span class="s2">&quot;sd&quot;</span><span class="p">))</span>	<span class="c1">## Whiskers showing the standard deviation</span>
	<span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>	
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/841c35ab6b96c4e8fe29af2b5192ead713fe1c673cf53d5ac91a1accb9939b02.png" src="../_images/841c35ab6b96c4e8fe29af2b5192ead713fe1c673cf53d5ac91a1accb9939b02.png" />
</div>
</div>
</section>
</section>
<section id="there-are-problems-with-bar-charts-and-errorbars-https-doi-org-10-1371-journal-pbio-1002128">
<h2>There are problems with bar charts and errorbars: <a class="reference external" href="https://doi.org/10.1371/journal.pbio.1002128">https://doi.org/10.1371/journal.pbio.1002128</a><a class="headerlink" href="#there-are-problems-with-bar-charts-and-errorbars-https-doi-org-10-1371-journal-pbio-1002128" title="Permalink to this heading">#</a></h2>
<section id="better-show-points-dots-for-every-trained-model-sample-and-statistics">
<h3>Better show points/dots for every trained model (sample) and statistics<a class="headerlink" href="#better-show-points-dots-for-every-trained-model-sample-and-statistics" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">so</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">feature_importances_long</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;importance_cv&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">)</span>
	<span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">so</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">pointsize</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">so</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">.0</span><span class="p">),</span> <span class="n">so</span><span class="o">.</span><span class="n">Jitter</span><span class="p">(</span><span class="mf">.5</span><span class="p">))</span> <span class="c1">## Jitter and Shift avoid overplotting</span>
<span class="c1">#!# .add(so.??(color=&quot;red&quot;), so.Agg())					## Show a dash with the average</span>
<span class="c1">#!# .add(so.??(color=&quot;red&quot;), so.Est(errorbar=&quot;sd&quot;))		## Show the range of the standard deviation </span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">so</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">so</span><span class="o">.</span><span class="n">Agg</span><span class="p">())</span>					<span class="c1">## Show a dash with the average</span>
	<span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">so</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">so</span><span class="o">.</span><span class="n">Est</span><span class="p">(</span><span class="n">errorbar</span><span class="o">=</span><span class="s2">&quot;sd&quot;</span><span class="p">))</span>		<span class="c1">## Show the range of the standard deviation</span>
	<span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>	
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/99c411b477e265d6e4eb27a925a5438c0a0e962734d4696a96d41b44ffad6e22.png" src="../_images/99c411b477e265d6e4eb27a925a5438c0a0e962734d4696a96d41b44ffad6e22.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./day3.3b_advanced_plotting"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="02_dataviz_MLunsupervised_solution.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Part 2 Data exploration by unsupervised learning</p>
      </div>
    </a>
    <a class="right-next"
       href="../CONDUCT.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Code of Conduct</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-feature-correlation-first-try">Plotting feature correlation: first try</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-with-standard-correlation-heatmap-colormap-not-suitable-and-features-not-ordered-by-similarity">Problem with standard correlation heatmap: colormap not suitable and features not ordered by similarity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-can-be-seen-in-the-correlation-heatmap">What can be seen in the correlation heatmap?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ml-show-case-predict-the-manuel-text-annotation-of-the-weather-by-the-numerical-features">ML show case: predict the manuel text annotation of the weather by the numerical features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#for-simplicity-reducing-to-top-categories">For simplicity reducing to Top categories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#insights-into-more-complex-ml-models-random-forest">Insights into more complex ML models: Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-results-confusion-matrix">Plotting results: confusion matrix</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-explainability-from-feature-importance">Getting explainability from feature importance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-importance-from-learned-models-across-all-cross-validations-for-robustness">Extracting importance from learned models across all cross validations for robustness</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#show-importance-as-bar-chart-including-errorbars">Show importance as bar chart including errorbars</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trick-flip-x-and-y-axis-for-readibility">Trick: flip x and y axis for readibility</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#there-are-problems-with-bar-charts-and-errorbars-https-doi-org-10-1371-journal-pbio-1002128">There are problems with bar charts and errorbars: https://doi.org/10.1371/journal.pbio.1002128</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#better-show-points-dots-for-every-trained-model-sample-and-statistics">Better show points/dots for every trained model (sample) and statistics</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Anja Neumann, Marie-Sophie von Braun, Matthias Täschner, Robert Haase
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on 2024-05-12.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
Copyright: Licensed <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY 4.0</a> unless mentioned otherwise. 
Contributions and feedback are welcome.
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>